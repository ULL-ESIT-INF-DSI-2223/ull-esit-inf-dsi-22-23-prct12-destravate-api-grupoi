<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>destravate</title><meta name="description" content="Documentation for destravate"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">destravate</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>destravate</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#desarrollo-de-sistemas-informáticos" id="desarrollo-de-sistemas-informáticos" style="color: inherit; text-decoration: none;">
  <h1>Desarrollo de Sistemas Informáticos</h1>
</a>

<a href="#práctica-12-destravate-api-nodeexpress" id="práctica-12-destravate-api-nodeexpress" style="color: inherit; text-decoration: none;">
  <h2><strong>Práctica 12. Destravate: API Node/Express</strong></h2>
</a>

<a href="#date-15052023" id="date-15052023" style="color: inherit; text-decoration: none;">
  <h4><strong>Date: 15/05/2023</strong></h4>
</a>

<a href="#el-github-pages-se-encuentra-en-el-siguiente-link" id="el-github-pages-se-encuentra-en-el-siguiente-link" style="color: inherit; text-decoration: none;">
  <h2>El GitHub Pages se encuentra en el siguiente <a href="https://ull-esit-inf-dsi-2223.github.io/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoi/">link</a>.</h2>
</a>

<a href="#el-link-del-vídeo-explicativo-es-el-siguiente-link" id="el-link-del-vídeo-explicativo-es-el-siguiente-link" style="color: inherit; text-decoration: none;">
  <h2>El link del vídeo explicativo es el siguiente: <a href="">link</a></h2>
</a>

<a href="#introducción" id="introducción" style="color: inherit; text-decoration: none;">
  <h2>Introducción</h2>
</a>
<p>El objetivo de esta práctica es implementar un API REST con Node/Express para realizar operaciones CRUD (Crear, Leer, Actualizar y Borrar) sobre un sistema de registro de actividades deportivas que se desarrolló en el anterior trabajo grupal.</p>
<p>Se requiere el uso de MongoDB como sistema de base de datos no relacional, y Mongoose para gestionar la base de datos desde Node.js utilizando esquemas. </p>
<p>Por último, se desplegará la API en cyclic, un servicio de alojamiento de aplicaciones web y APIs en la nube que permite desplegar aplicaciones fácilmente sin tener que preocuparse por la gestión de infraestructuras y servidores.</p>

<a href="#novedades-respecto-a-la-entrega-anterior" id="novedades-respecto-a-la-entrega-anterior" style="color: inherit; text-decoration: none;">
  <h2>Novedades respecto a la entrega anterior</h2>
</a>
<ul>
<li>Ya no se utiliza inquier</li>
<li>La base de datos ya no es un json</li>
<li>La clase Gestor ya no es necesaria</li>
</ul>

<a href="#implementación" id="implementación" style="color: inherit; text-decoration: none;">
  <h2>Implementación</h2>
</a>

<a href="#typests" id="typests" style="color: inherit; text-decoration: none;">
  <h3>Types.ts</h3>
</a>
<ul>
<li>Estructura ResponseType: En el fichero Types.ts se encuentra el tipo de respuesta que utiliza nuestra api con express el tipo es el siguiente:</li>
</ul>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">T</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">    </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">success</span><span class="hl-1">: </span><span class="hl-3">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">output</span><span class="hl-1">: </span><span class="hl-3">IGrupoData</span><span class="hl-1">[] | </span><span class="hl-3">IRetoData</span><span class="hl-1">[] | </span><span class="hl-3">IUsuarioData</span><span class="hl-1">[] | </span><span class="hl-3">IRutaData</span><span class="hl-1">[] | </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">error</span><span class="hl-1">?: </span><span class="hl-3">T</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>tiene el tipo de respuesta, si es cuando queremos añadir a la base de datos un elemento(add), si es cuando intentamos eliminar(remove), cuando es para actualizar(update), o para hacer un get (read).
Después está success, que si es true es que la operación ha sido satisfactoria, output para devolver los grupos, retos… y por último si success es false se envía el error que ha sucedido en error.</p>

<a href="#appts" id="appts" style="color: inherit; text-decoration: none;">
  <h3>App.ts</h3>
</a>
<ul>
<li>Uso de express</li>
</ul>
<p>Para usar express para el servidor, en primer lugar se pone la siguiente linea, en el fichero App.ts:
<code>export const app = express();</code></p>
<p>También tendremos que poner la siguiente línea para poder acceder al body de las peticiones:
<code>app.use(bodyParser.json());</code></p>
<p>Después al final del código se pone la siguiente línea para que el servidor esté escuchando en el puerto 3000:</p>
<pre><code class="language-ts"><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">listen</span><span class="hl-1">(</span><span class="hl-7">3000</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Server is up on port 3000&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Y después debemos de crear para usuarios, grupos, retos y rutas, un get para hacer una petición de la información, un post para subir nuevos usuarios, grupos, retos y rutas un delete y un patch para modificarlos. Para las rutas, se accede a la ruta /tracks, para usuarios /users, para grupos, /groups y para rutas /challenges. Y si se accede a otra ruta se gestiona al final de todo con el siguiente código:</p>
<pre><code class="language-ts"><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-5">&#39;*&#39;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">404</span><span class="hl-1">).</span><span class="hl-6">json</span><span class="hl-1">({</span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Route not found&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Para no estar explicado para cada uno, ya que es prácticamente lo mismo, se explicará para Rutas:
Primero se explicará el post para subir una ruta a la base de datos:
Primero de nada creamos un esquema bastante parecido al que creamos para crear el modelo, y así gracias a Ajv validamos que la información pasada en el body es correcta para subirla a la base de datos:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">schemaTrack</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;object&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">properties:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-9">//id: { id: &#39;string&#39; },</span><br/><span class="hl-1">      </span><span class="hl-4">nombre:</span><span class="hl-1"> { </span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">inicio:</span><span class="hl-1"> { </span><span class="hl-4">inicio:</span><span class="hl-1"> </span><span class="hl-5">&#39;Geolocalizacion&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">final:</span><span class="hl-1"> { </span><span class="hl-4">final:</span><span class="hl-1"> </span><span class="hl-5">&#39;Geolocalizacion&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">longitud:</span><span class="hl-1"> { </span><span class="hl-4">longitud:</span><span class="hl-1"> </span><span class="hl-5">&#39;number&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">desnivel:</span><span class="hl-1"> { </span><span class="hl-4">desnivel:</span><span class="hl-1"> </span><span class="hl-5">&#39;number&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">usuarios:</span><span class="hl-1"> { </span><span class="hl-4">usuarios:</span><span class="hl-1"> </span><span class="hl-5">&#39;string[]&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">actividad:</span><span class="hl-1"> { </span><span class="hl-4">actividad:</span><span class="hl-1"> </span><span class="hl-5">&#39;Actividad&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">calificacion:</span><span class="hl-1"> { </span><span class="hl-4">calificacion:</span><span class="hl-1"> </span><span class="hl-5">&#39;number&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">required:</span><span class="hl-1"> [</span><span class="hl-9">/*&#39;id&#39;,*/</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">,</span><span class="hl-5">&#39;inicio&#39;</span><span class="hl-1">,</span><span class="hl-5">&#39;final&#39;</span><span class="hl-1">,</span><span class="hl-5">&#39;longitud&#39;</span><span class="hl-1">,</span><span class="hl-5">&#39;desnivel&#39;</span><span class="hl-1">,</span><span class="hl-5">&#39;usuarios&#39;</span><span class="hl-1">,</span><span class="hl-5">&#39;actividad&#39;</span><span class="hl-1">,</span><span class="hl-5">&#39;calificacion&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">};</span><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">validateTrack</span><span class="hl-1"> = </span><span class="hl-4">ajv</span><span class="hl-1">.</span><span class="hl-6">compile</span><span class="hl-1">(</span><span class="hl-4">schemaTrack</span><span class="hl-1">);</span>
</code></pre>
<p>Ahora si podemos explicar las diferentes peticiones https que se pueden realizar a la api</p>
<ul>
<li>Post:</li>
</ul>
<pre><code class="language-ts"><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">post</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1"> </span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">) == </span><span class="hl-5">&quot;{}&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Debe introducir los datos de la ruta&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> })</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">trackData</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">RutaModel</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">isValid</span><span class="hl-1"> = </span><span class="hl-6">validateTrack</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">   </span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">isValid</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">trackData</span><span class="hl-1">.</span><span class="hl-6">save</span><span class="hl-1">().</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">RutaGuardada</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">RutaGuardada</span><span class="hl-1">);</span><br/><span class="hl-1">      }).</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">err</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">validateTrack</span><span class="hl-1">.</span><span class="hl-4">errors</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/>
</code></pre>
<p>Como se puede ver, lo primero que se hace es comprobar que el body no esté vacío, si es asi, se devuelve un error con status 400. Después de esto, se declara un modelo con la información de la ruta y se valida con Ajv, si es válido se guarda en la base de datos con save y se controlan los errores, si no se puede validar, se envía una respuesta con el error y un código 400.</p>
<ul>
<li>Get</li>
</ul>
<pre><code class="language-ts"><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1"> == </span><span class="hl-2">undefined</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> == </span><span class="hl-2">undefined</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1">{</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">tracks</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">RutaModel</span><span class="hl-1">.</span><span class="hl-6">find</span><span class="hl-1">().</span><span class="hl-6">populate</span><span class="hl-1">(</span><span class="hl-5">&#39;usuarios&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">tracks</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">err</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-9">//Por Nombre</span><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1">{</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">nombre</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">tracks</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">RutaModel</span><span class="hl-1">.</span><span class="hl-6">findOne</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">nombre</span><span class="hl-1">}).</span><span class="hl-6">populate</span><span class="hl-1">(</span><span class="hl-5">&#39;usuarios&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">tracks</span><span class="hl-1"> != </span><span class="hl-2">null</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">tracks</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1">{</span><br/><span class="hl-1">          </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;El nombre no coincide con ninguna ruta&quot;</span><br/><span class="hl-1">          };</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1">(</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">err</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-9">//Por Id</span><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1">{</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">id</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">tracks</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">RutaModel</span><span class="hl-1">.</span><span class="hl-6">findById</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">).</span><span class="hl-6">populate</span><span class="hl-1">(</span><span class="hl-5">&#39;usuarios&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">tracks</span><span class="hl-1"> != </span><span class="hl-2">null</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">tracks</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1">{</span><br/><span class="hl-1">          </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;El id no coincide con ninguna ruta&quot;</span><br/><span class="hl-1">          };</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1">(</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">err</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/>
</code></pre>
<p>Lo primero que se comprueba es que se pase un id o un nombre, si no es así se buscan todas las rutas con el find() y se devuelve el json con todas las pistas con un código 200. Como es una promesa, se comprueban los errores al buscar, si falla se recoge el error y se envía un código 400 con el error.
Si no es así, se comprueba que se ha pasado un nombre y si es así se busca por nombre, y se comprueban si se ha devuelto null, esto es que ninguna ruta coincide con el nombre por lo que se envía el error, si no es así se envía la ruta con el código 200.
Si se ha pasado un id, se hace lo mismo que cuando se le pasa un nombre pero buscando por id.</p>
<ul>
<li>Delete</li>
</ul>
<pre><code class="language-ts"><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1"> </span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-9">//Por Nombre</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">nombre</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">RutaModel</span><span class="hl-1">.</span><span class="hl-6">deleteOne</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">nombre</span><span class="hl-1">}).</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">deletedCount</span><span class="hl-1"> == </span><span class="hl-7">1</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><span class="hl-0">else</span><span class="hl-1">{</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;El nombre no coincide con ninguna ruta&quot;</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }).</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">err</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-9">//Por Id</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">id</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">RutaModel</span><span class="hl-1">.</span><span class="hl-6">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">).</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1"> != </span><span class="hl-2">null</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><span class="hl-0">else</span><span class="hl-1">{</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;El nombre no coincide con ninguna ruta&quot;</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }).</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">err</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">outputError</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Un nombre o un id deben ser introducidos&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">outputError</span><span class="hl-1"> })</span><br/><span class="hl-1">  }  </span><br/><span class="hl-1">});</span><br/>
</code></pre>
<p>En primer lugar se comprueba si se ha pasado un nombre, si no es así, un id, y si no ha recibido ninguno, devuelve el error con el responsetype con código 400.
Si se recibe un nombre, se llama a delteOne con el nombre, si el resultado tiene un deleteCount de 1 quiere decir que se ha eliminado una ruta, por lo que se devuelve una respuesta 200, si no es así, es que no ha encontrado ninguna ruta con ese nombre, por lo que se devuelve el código 400 más el response type con el error. También se controla el error al acceder a la base de datos. Al eliminar con id es lo mismo, pero se utiliza findByIdAndDelete.</p>
<ul>
<li>Patch</li>
</ul>
<pre><code class="language-ts"><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-6">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1"> </span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">) == </span><span class="hl-5">&quot;{}&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Debe introducir los datos de la ruta a modificar&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> })</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-9">//Por Nombre</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">nombre</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">aModificar</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">RutaModel</span><span class="hl-1">.</span><span class="hl-6">updateOne</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">nombre</span><span class="hl-1">}, </span><span class="hl-4">aModificar</span><span class="hl-1">).</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">modifiedCount</span><span class="hl-1"> &gt;= </span><span class="hl-7">1</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><span class="hl-0">else</span><span class="hl-1">{</span><br/><span class="hl-1">          </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;El nombre o el elemento a modificar no coinciden con ninguna ruta&quot;</span><br/><span class="hl-1">          };</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }).</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">err</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">         </span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-9">//Por Id</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">id</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">aModificar</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">;</span><br/><br/><br/><span class="hl-1">      </span><span class="hl-4">RutaModel</span><span class="hl-1">.</span><span class="hl-6">findByIdAndUpdate</span><span class="hl-1">( </span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">aModificar</span><span class="hl-1">).</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1"> != </span><span class="hl-2">null</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><span class="hl-0">else</span><span class="hl-1">{</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;El nombre o el elemento a modificar no coinciden con ninguna ruta&quot;</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }).</span><span class="hl-6">catch</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">Ajv</span><span class="hl-1">.</span><span class="hl-3">ErrorObject</span><span class="hl-1">[] | </span><span class="hl-3">null</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">err</span><br/><span class="hl-1">      };</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">error</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">output:</span><span class="hl-1"> </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Debe introducir la id o el nombre de la ruta a modificar&#39;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-6">status</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> })</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/>
</code></pre>
<p>Es bastante parecida a la estructura de las otras peticiones, primero se comprueba que el body no está vacío, después si se pasa un nombre se llama a update one con el nombre y el body que tendrá un json con lo que se quiere modificar de la ruta. Si se devuelve un modifycount de 1 es que se modificó satisfactoriamente la ruta, pero si no es que no se modificó nada por lo que o el nombre no coincide con ninguna ruta o el json pasado no era correcto. Se hace lo mismo por id, pero por findbyid. 
Si no se pasa ni un id ni un nombre devuelve un error también.</p>
<ul>
<li>Populate</li>
</ul>
<p>Para realizar el populate, primero debiamos conectar los modelos de esta forma:
<code> usuarios: IUsuarioDocument[&quot;_id&quot;][];</code></p>
<p>De esta forma se conectan entre modelos y crean dependencias entre ellos.</p>
<pre><code class="language-ts"><span class="hl-1">    </span><span class="hl-10">usuarios</span><span class="hl-1">: [{</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">mongoose</span><span class="hl-1">.</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Usuario&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    }],</span>
</code></pre>
<p>Después de modificar los modelos, en la parte del servidor lo utilizamos de la siguiente forma:
<code>const tracks = await RutaModel.find().populate(&#39;usuarios&#39;, &#39;nombre&#39;);</code></p>
<p>De esta forma podemos indicarle al modelo de ruta, que coja la variable usuarios y nos muestre aparte del id de los usuarios, el nombre también. Si tenemos más variables que deseamos cambiar se pueden hacer varios populates como en el caso de Usuarios:
<code>const users = await UsuarioModel.find().populate(&#39;rutas&#39;, &#39;nombre&#39;).populate(&#39;grupos&#39;, &#39;nombre&#39;).populate(&#39;amigos&#39;, &#39;nombre&#39;).populate(&#39;retos&#39;, &#39;nombre&#39;);</code></p>

<a href="#modelos" id="modelos" style="color: inherit; text-decoration: none;">
  <h3>Modelos</h3>
</a>
<p>Para guardar la información que se le pasa a la api, o acceder a la ya guardada, se utiliza Mongoose, y lo primero que tenemos que hacer es definir los modelos. Los modelos se definen dentro de una carpeta llamada Modelos, dentro de src, contendrá en ficheros separados, modelos para guardar con mongoose en la base de datos, los grupos, los regos, las rutas y los usuarios, así como para acceder a ellos, modificarlos y borrar. Como todos son por el estilo, pero cambiando la información que se utiliza, explicaré el de Usuarios:
En primer lugar se ha creado una interfaz para las estadísticas, que tienen el desnivel y los km de la semana, el mes y el año.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">EstadisticasEntrenamiento</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">semana</span><span class="hl-1">: { </span><span class="hl-4">km</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">; </span><span class="hl-4">desnivel</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1"> };</span><br/><span class="hl-1">    </span><span class="hl-4">mes</span><span class="hl-1">: { </span><span class="hl-4">km</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">; </span><span class="hl-4">desnivel</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1"> };</span><br/><span class="hl-1">    </span><span class="hl-4">anio</span><span class="hl-1">: { </span><span class="hl-4">km</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">; </span><span class="hl-4">desnivel</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1"> };</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Ahora sí, para definir el modelo, primero tenemos que crear una interfaz que hereda de Document de mongoose, esta interfaz tiene la información que tiene cada usuario.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">IUsuarioDocument</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">nombre</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">actividad</span><span class="hl-1">: </span><span class="hl-3">Actividad</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">amigos</span><span class="hl-1">: </span><span class="hl-3">IUsuarioDocument</span><span class="hl-1">[</span><span class="hl-5">&quot;_id&quot;</span><span class="hl-1">][];</span><br/><span class="hl-1">    </span><span class="hl-4">grupos</span><span class="hl-1">: </span><span class="hl-3">IGrupoData</span><span class="hl-1">[</span><span class="hl-5">&quot;_id&quot;</span><span class="hl-1">][];</span><br/><span class="hl-1">    </span><span class="hl-4">estadisticas</span><span class="hl-1">: </span><span class="hl-3">EstadisticasEntrenamiento</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">rutas</span><span class="hl-1">: </span><span class="hl-3">RutaDocument</span><span class="hl-1">[</span><span class="hl-5">&quot;_id&quot;</span><span class="hl-1">][];</span><br/><span class="hl-1">    </span><span class="hl-4">retos</span><span class="hl-1">: </span><span class="hl-3">IRetoData</span><span class="hl-1">[</span><span class="hl-5">&quot;_id&quot;</span><span class="hl-1">][];</span><br/><span class="hl-1">    </span><span class="hl-4">historicoRutas</span><span class="hl-1">: </span><span class="hl-3">Map</span><span class="hl-1">&lt;</span><span class="hl-3">string</span><span class="hl-1">, </span><span class="hl-3">string</span><span class="hl-1">[]&gt;;</span><br/><span class="hl-1">  }</span>
</code></pre>
<p>Una vez hecho esto creamos un esquema que contendrá la información de la interfaz, pero diciendo el tipo, si referencia a alguna sitio, si no se le pasa nada que tendrá por defecto, si es un campo referido o no…</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">UsuarioSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-4">mongoose</span><span class="hl-1">.</span><span class="hl-6">Schema</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">nombre:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">actividad:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">enum:</span><span class="hl-1"> </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-6">values</span><span class="hl-1">(</span><span class="hl-4">Actividad</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">amigos:</span><span class="hl-1"> [{</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">mongoose</span><span class="hl-1">.</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Usuario&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">default:</span><span class="hl-1"> []</span><br/><span class="hl-1">    }],</span><br/><span class="hl-1">    </span><span class="hl-4">grupos:</span><span class="hl-1"> [{</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">mongoose</span><span class="hl-1">.</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Grupo&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">default:</span><span class="hl-1"> []</span><br/><span class="hl-1">    }],</span><br/><span class="hl-1">    </span><span class="hl-4">estadisticas:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">semana:</span><span class="hl-1"> { </span><span class="hl-4">km:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">, </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-7">0</span><span class="hl-1"> }, </span><span class="hl-4">desnivel:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">, </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-7">0</span><span class="hl-1"> } },</span><br/><span class="hl-1">      </span><span class="hl-4">mes:</span><span class="hl-1"> { </span><span class="hl-4">km:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">, </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-7">0</span><span class="hl-1"> }, </span><span class="hl-4">desnivel:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">, </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-7">0</span><span class="hl-1"> } },</span><br/><span class="hl-1">      </span><span class="hl-4">anio:</span><span class="hl-1"> { </span><span class="hl-4">km:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">, </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-7">0</span><span class="hl-1"> }, </span><span class="hl-4">desnivel:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">, </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-7">0</span><span class="hl-1"> } },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">rutas:</span><span class="hl-1"> [{</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">mongoose</span><span class="hl-1">.</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Ruta&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">default:</span><span class="hl-1"> []</span><br/><span class="hl-1">    }],</span><br/><span class="hl-1">    </span><span class="hl-4">retos:</span><span class="hl-1"> [{</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">mongoose</span><span class="hl-1">.</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&quot;Reto&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">default:</span><span class="hl-1"> []</span><br/><span class="hl-1">    }],</span><br/><span class="hl-1">    </span><span class="hl-4">historicoRutas:</span><span class="hl-1"> { </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Map</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">of:</span><span class="hl-1"> [</span><span class="hl-4">String</span><span class="hl-1">],</span><br/><span class="hl-1">        </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">Map</span><span class="hl-1">()</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  });</span>
</code></pre>
<p>Y por último definimos el modelo que se llamará UsuarioModel y que se crea con el esquema y la interfaz creada en los pasos anteriores.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">UsuarioModel</span><span class="hl-1"> = </span><span class="hl-6">model</span><span class="hl-1">&lt;</span><span class="hl-3">IUsuarioDocument</span><span class="hl-1">&gt;(</span><span class="hl-5">&#39;Usuario&#39;</span><span class="hl-1">, </span><span class="hl-4">UsuarioSchema</span><span class="hl-1">);</span>
</code></pre>
<p>Hacemos esto para los grupos, retos y rutas, pero con la información que guarda cada uno.</p>

<a href="#ejemplos-de-ejecución" id="ejemplos-de-ejecución" style="color: inherit; text-decoration: none;">
  <h2>Ejemplos de ejecución</h2>
</a>

<a href="#operación-post" id="operación-post" style="color: inherit; text-decoration: none;">
  <h3>Operación POST</h3>
</a>
<p><img src="Assets/Img/rutaPost.png" alt="Ej POST"></p>
<p><img src="Assets/Img/rutaPostDB.png" alt="Ej POST DB"></p>

<a href="#operación-get" id="operación-get" style="color: inherit; text-decoration: none;">
  <h3>Operación GET</h3>
</a>
<p><img src="Assets/Img/rutaGet.png" alt="Ej GET"></p>

<a href="#operación-delete" id="operación-delete" style="color: inherit; text-decoration: none;">
  <h3>Operación DELETE</h3>
</a>
<p><img src="Assets/Img/rutaDelete.png" alt="Ej DELETE"></p>

<a href="#operación-patch" id="operación-patch" style="color: inherit; text-decoration: none;">
  <h3>Operación PATCH</h3>
</a>
<p><img src="Assets/Img/rutaPatch.png" alt="Ej PATCH"></p>

<a href="#pruebas-de-desarrollo" id="pruebas-de-desarrollo" style="color: inherit; text-decoration: none;">
  <h2>Pruebas de desarrollo</h2>
</a>
<p>Para realizar las pruebas con Mocha Chai lo primero que hemos realizado es </p>
<pre><code class="language-ts"><span class="hl-6">beforeEach</span><span class="hl-1">(</span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">UsuarioModel</span><span class="hl-1">.</span><span class="hl-6">deleteMany</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">GrupoModel</span><span class="hl-1">.</span><span class="hl-6">deleteMany</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">RutaModel</span><span class="hl-1">.</span><span class="hl-6">deleteMany</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">RetoModel</span><span class="hl-1">.</span><span class="hl-6">deleteMany</span><span class="hl-1">();</span><br/><span class="hl-1">});</span>
</code></pre>
<p>De esta forma vaciamos la base de datos y así puede ejecutar las pruebas más de una vez sin que haya problemas de dependencias. Vamos a explicar solo como hemos hecho las pruebas de rutas ya que el resto son iguales (grupos, retos y usuarios). Las pruebas están divididas en POST, DELETE, GET y PATCH:</p>
<ul>
<li>POST</li>
</ul>
<pre><code class="language-ts"><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-5">&#39;POST /tracks&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should successfully create a new route&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">).</span><span class="hl-6">post</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">).</span><span class="hl-6">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;nombre&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Ruta Prueba&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;inicio&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;final&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">5</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;desnivel&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">100</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;usuarios&quot;</span><span class="hl-4">:</span><span class="hl-1"> [],</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;actividad&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Correr&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;calificacion&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">4</span><br/><span class="hl-1">        }).</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code></pre>
<p>En esta prueba simplemente creamos una nueva ruta y nos aseguramos que todo funcione correctamente.</p>
<ul>
<li>DELETE</li>
</ul>
<pre><code class="language-ts"><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-5">&#39;DELETE /tracks&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should successfully delete a route by id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">newRoute</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">RutaModel</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;nombre&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Ruta Prueba&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;inicio&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;final&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">5</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;desnivel&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">100</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;usuarios&quot;</span><span class="hl-4">:</span><span class="hl-1"> [],</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;actividad&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Correr&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;calificacion&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">4</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">savedRoute</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">newRoute</span><span class="hl-1">.</span><span class="hl-6">save</span><span class="hl-1">();</span><br/><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">query</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">savedRoute</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should return an error when no id is provided&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">).</span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">).</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code></pre>
<p>La primera prueba se asegura de eliminar un nuevo usuario sin problema y la segunda es para comprobar que haya un error cuando no se introduce ningún id.</p>
<ul>
<li>GET</li>
</ul>
<pre><code class="language-ts"><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-5">&#39;GET /tracks&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should successfully get all routes&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">).</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">).</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should successfully get a route by id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">newRoute</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">RutaModel</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;nombre&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Ruta Prueba&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;inicio&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;final&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">5</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;desnivel&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">100</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;usuarios&quot;</span><span class="hl-4">:</span><span class="hl-1"> [],</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;actividad&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Correr&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;calificacion&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">4</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">savedRoute</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">newRoute</span><span class="hl-1">.</span><span class="hl-6">save</span><span class="hl-1">();</span><br/><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">query</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">savedRoute</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should return an error when no route is found by id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">query</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-5">&#39;non-existent-id&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Aquí nos aseguramos primero de que muestre todas las rutas con éxito, luego creamos una ruta y que enseñe toda la información de esa ruta recién creada. Al final comprobamos que muestre un error si no se encuentra ninguna ruta con un id inexistente.</p>
<ul>
<li>PATCH</li>
</ul>
<pre><code class="language-ts"><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-5">&#39;PATCH /tracks&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should successfully update a route by id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">newRoute</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">RutaModel</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;nombre&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Ruta Prueba&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;inicio&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;final&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">5</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;desnivel&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">100</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;usuarios&quot;</span><span class="hl-4">:</span><span class="hl-1"> [],</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;actividad&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Correr&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;calificacion&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">4</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">            </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">savedRoute</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">newRoute</span><span class="hl-1">.</span><span class="hl-6">save</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">query</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">savedRoute</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-6">send</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;nombre&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Ruta Actualizada&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;inicio&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;final&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">10</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;desnivel&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">200</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;usuarios&quot;</span><span class="hl-4">:</span><span class="hl-1"> [],</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;actividad&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Correr&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;calificacion&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">5</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">200</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should return an error when no id is provided&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">).</span><span class="hl-6">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">).</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should return an error when no route is found by id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">request</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">            .</span><span class="hl-6">query</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-5">&quot;idnoexistente&quot;</span><span class="hl-1"> })</span><br/><span class="hl-1">            .</span><span class="hl-6">send</span><span class="hl-1">({</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;nombre&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Ruta Actualizada&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;inicio&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;final&quot;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-5">&quot;latitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">40.7128</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> -</span><span class="hl-7">74.0060</span><br/><span class="hl-1">                },</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;longitud&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">10</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;desnivel&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">200</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;usuarios&quot;</span><span class="hl-4">:</span><span class="hl-1"> [],</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;actividad&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;Correr&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-5">&quot;calificacion&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-7">5</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">            .</span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-7">400</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Primera prueba modifica una ruta por el id y lo hace con éxito. Después comprueba que si no se introduce un id, devuelve un error. La última prueba es introducir un id no existente y asegurarse de que muestre un error.
Para el resto de clases funciona de la misma manera todos.</p>

<a href="#ejecución-pruebas" id="ejecución-pruebas" style="color: inherit; text-decoration: none;">
  <h3>Ejecución pruebas</h3>
</a>

<a href="#despliegue" id="despliegue" style="color: inherit; text-decoration: none;">
  <h2>Despliegue</h2>
</a>
<p>Para el proceso de despliegue del API REST se requería crear un clúster en MongoDB Atlas.</p>
<p>El primer paso fue registrarse en MongoDB Atlas y crear una organización y un proyecto. Luego, se creó un clúster compartido con el proveedor de servicios en la nube de AWS . </p>
<p><img src="Assets/Img/mongodb.png" alt="Ej Clúster"></p>
<p>Una vez creado el clúster se generó una URL de conexión con el nombre de usuario y contraseña de un usuario con permisos de lectura y modificación sobre la base de datos.</p>
<p>Esta URL se almacenó en una variable de entorno dentro de la plataforma Cyclic para el despliegue de API’s. </p>
<p>Para el despliegue sobre esta plataforma fue necesario añadir dos script: build y start al package.json del proyecto, crear una cuenta en la plataforma y por último enlazar el repositorio público de la API.</p>
<p>Como resultado obtuvimos una URL (<a href="https://vast-gold-brown-bear-suit.cyclic.app/">https://vast-gold-brown-bear-suit.cyclic.app/</a>) correspondiente a un servidor siempre operativo a través del cuál podremos hacer peticiones HTTP, por ejemplo, mediante el uso de ThunderClient.</p>
<p><img src="Assets/Img/cyclic.png" alt="Ej Cyclic"></p>

<a href="#referencias" id="referencias" style="color: inherit; text-decoration: none;">
  <h2>Referencias</h2>
</a>
<ul>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/prct12-destravate-api/">Enunciado Práctica</a></li>
<li><a href="https://www.cyclic.sh/">Cyclic</a></li>
<li><a href="https://www.mongodb.com/cloud/atlas/">MongoDB</a></li>
<li><a href="https://mongoosejs.com/">Mongoose</a></li>
<li><a href="https://ajv.js.org/guide/typescript.html/">Ajv Scheme Validator</a></li>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/nodejs-deployment.html/">Despliegue API</a></li>
</ul>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">destravate</a>
<ul>
<li class="tsd-kind-module"><a href="modules/Actividad.html">Actividad</a></li>
<li class="tsd-kind-module"><a href="modules/App.html">App</a></li>
<li class="tsd-kind-module"><a href="modules/EstadisticasEntrenamiento.html">Estadisticas<wbr/>Entrenamiento</a></li>
<li class="tsd-kind-module"><a href="modules/GeneradorIdUnicos.html">Generador<wbr/>Id<wbr/>Unicos</a></li>
<li class="tsd-kind-module"><a href="modules/Gestor.html">Gestor</a></li>
<li class="tsd-kind-module"><a href="modules/Grupo.html">Grupo</a></li>
<li class="tsd-kind-module"><a href="modules/Reto.html">Reto</a></li>
<li class="tsd-kind-module"><a href="modules/Ruta.html">Ruta</a></li>
<li class="tsd-kind-module"><a href="modules/Types.html">Types</a></li>
<li class="tsd-kind-module"><a href="modules/Usuario.html">Usuario</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>